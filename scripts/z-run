#!/dev/null




::// docs / ...
::// watch / ...




&&== env-path _RUST_SOURCES ./sources
&&== env-path _RUST_TARGET ./.target




<< debug / build / lib
	#! <bash+>
	Z_expect_no_arguments
	Z_zexec ':: cargo / run' build --lib
!!

<< debug / run / example
	#! <bash+>
	Z_zexec ':: cargo / run' run --bin example -- "${@}"
!!

<< docs / crate / internals / build
	#! <bash+>
	Z_expect_no_arguments
	Z_zexec ':: cargo / run' doc --lib --no-deps --document-private-items
!!

<< docs / crate / exports / build
	#! <bash+>
	Z_expect_no_arguments
	Z_zexec ':: cargo / run' doc --lib --no-deps
!!

<< docs / crate / dependencies / build
	#! <bash+>
	Z_expect_no_arguments
	Z_zexec ':: cargo / run' doc --lib
!!

<< docs / crate / open
	#! <bash+>
	Z_expect_no_arguments
	exec -- x-www guest:rust-docs open "file:${_RUST_TARGET}/doc/hyper_simple_server/index.html"
!!




<<== __ / generate
	#! <template>
	
	{{ $_watch_actions := array }}
	{{ $_watch_actions = array_append $_watch_actions "debug / build / lib" "debug / run / example" }}
	{{ $_watch_actions = array_append $_watch_actions "docs / crate / internals / build" "docs / crate / exports / build" "docs / crate / dependencies / build" }}
	
	{{ range $_, $_action := $_watch_actions }}
	<< watch / {{ $_action }}
		#! <bash+>
		Z_expect_no_arguments
		Z_zexec ':: watch / run' ':: '{{ $_action | shell_quote }}
	!!
	{{ end }}
!!




--<< cargo / run
	#! <bash+>
	
	Z_enforce 0xd425e0f4 'expected command!' test "${#}" -ge 1
	
	_command="${1}"
	shift -- 1
	
	_arguments=()
	
	case "${_command}" in
		( build | run | doc )
			_arguments+=(
					--manifest-path "${_RUST_SOURCES}/Cargo.toml" \
					--target-dir "${_RUST_TARGET}" \
				)
		;;
		( * )
			Z_panic 0x510d7e97 'invalid command `%s`!' "${_command}"
		;;
	esac
	
	exec -- \
		nice -n 19 -- \
	cargo \
			"${_command}" \
			"${_arguments[@]}" \
			"${@}" \
	#
!!




--<< watch / run
	#! <bash+>
	exec -- \
		nodaemon \
	watchexec \
			\
			--watch "${_RUST_SOURCES}" \
			\
			--restart \
			--debounce 100 \
			\
			--no-shell \
			--no-ignore \
			--no-vcs-ignore \
			--no-default-ignore \
			\
			-- \
			\
		nodaemon \
	"${ZRUN[@]}" \
			':: watch / delegate' \
			"${@}"
	#
!!


--<< watch / delegate
	#! <bash+>
	Z_log_cut
	Z_zexec "${@}"
!!

